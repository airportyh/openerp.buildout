<VirtualHost *:443>
    ServerName ${openerp:web-domain}

    SSLEngine on
    SSLCertificateFile ${buildout:directory}/parts/self-signed.crt
    SSLCertificateKeyFile ${buildout:directory}/parts/private.key

    <Proxy *>
        Order deny,allow
        Allow from all
        # HTTP authentication
        AuthType Basic
        AuthName "Confidential access"
        AuthUserFile /etc/apache2/passwords
        Require valid-user
    </Proxy>

    ProxyRequests Off
    ProxyPass        / http://127.0.0.1:8080/
    ProxyPassReverse / http://127.0.0.1:8080/
    ProxyPreserveHost On
    RequestHeader set "X-Forwarded-Proto" "https"

    # Fix IE problem (http error 408/409)
    SetEnv proxy-nokeepalive 1

    ErrorLog /var/log/apache2/${openerp:web-domain}-ssl-error.log
    CustomLog /var/log/apache2/${openerp:web-domain}-ssl-access.log combined

</VirtualHost>

<VirtualHost *:80>
    ServerName ${openerp:web-domain}

    RedirectMatch .* https://${openerp:web-domain}/
</VirtualHost>
